# Packaging ng aplikasyon

Para maiwasan ang [issues](https://github.com/joyent/node/issues/6960) sa paligid ng mahabang pangalan sa landas ng Windows, bahagyang mapapabilis ang `require` para itago ang iyong source code mula sa pinasimpleng inspeksyon, pwede kang mamili para I- package ang iyong app isang [asar](https://github.com/electron/asar) na aktibo sa maliit na pag babago sa iyong source code.

## Pagbuo ng `asar` na aktibo

Ang "[asar](https://github.com/electron/asar) archive" ay isang simpleng ayos tulad ng "tar" na dinudugtong sa mga payl upang maging isang payl. Ang Elektron ay maaaring basahin ang mga payl na arbitraryo galing dito nang hindi kinukuha sa buong payl.

Mga hakbang para mailagak ang iyong "app" sa "archive" ng `asar`:

### 1. Iinstol ang "asar Utility"

```sh
$ npm install -g asar
```

### 2. Ang ilang "software" kasama ang `asar pack`

```sh
$ asar pack your-app app.asar
```

## Gamit ang "Archives" ng `asar`

Sa Elektron, mayroong dalawang nakatakdang "APIs": "Node APIs" na galing sa Node.js at ang "Web APIs na galing sa " Chrilomium". Ang parehong "APIs" ay sumusuporta sa pagbasa ng mga payl galing sa mga "archive" ng `asar`.

### "Node API"

Kasama ang espesyal na "patches" sa Elektron, "Node APIs" tulad ng `fs.readFile` at `require` ay itinuturing ang "archive" ng `asar` bilang mga direktoryo ng birtwal, at ang mga payl dito at bilang mga normal na payl sa sistema nito.

Halimbawa, ating ipagpalagay na ang "archive" na `example.asar` sa ilalim ng `/path/to`:

```sh
$ asar list /path/to/example.asar
/app.js
/file.txt
/dir/module.js
/static/index.html
/static/main.css
/static/jquery.min.js
```

Basahin ang oayl sa "archive" ng `asar`:

```javascript
const fs = require('fs')
fs.readFileSync('/path/to/example.asar/file.txt')
```

Ang listahan ng lahat ng payl sa ilalim ng "root" ng "archive":

```javascript
const fs = require('fs')
fs.readdirSync('/path/to/example.asar')
```

Gumamit ng modyul galing sa "archive":

```javascript
require('/path/to/example.asar/dir/module.js')
```

Maaari ring i-display ang pahina ng "web" sa "archive" na `asar` kasama ang `BrowserWindow`:

```javascript
const {BrowserWindow} = require('electron')
let win = new BrowserWindow({width: 800, height: 600})
win.loadURL('file:///path/to/example.asar/static/index.html')
```

### "Web API"

Sa pahina ng "web", ang mga payl na nasa "archive" ay maaaring hilingin sa protokol ng `file:`. Tulad ng "Node API", ang mga "archive" ng `asar` ay tinuturing bilang mga direktoryo.

Halimbawa, para makuha ang payl gamit ang `$.get`:

```html
<script>
let $ = require('./jquery.min.js')
$.get('file:///path/to/example.asar/file.txt', (data) => {
  console.log(data)
})
</script>
```

### Itinuturing ang "Archive" ng `asar` bilang Normal na Payl

Para sa ibang mga kaso tulad ng pagkumpirma sa "archive's checksum" ng `asar`, kinakailangan nating basahin ang nilalaman ng "archive" ng `asar` bilang payl. Para sa layuning ito, maaaring gumamit ng "built-in" na modyul ng `original-fs` na nagbibigay ng orihinal na `fs` APIs nang hindi kasama ang suporta ng `asar`:

```javascript
const originalFs = require('original-fs')
originalFs.readFileSync('/path/to/example.asar')
```

Maaari ring itakda ang `process.noAsar` sa `true` para hindi magamit an suporta para sa `asar` sa modyul ng `fs`:

```javascript
const fs = require('fs')
process.noAsar = true
fs.readFileSync('/path/to/example.asar')
```

## Mga Limitasyon ng Node API

Kahit pa ating subukan na gumawa ng "archive" ng `asar`, hangga't maaari sa loob ng "Node API" tulad ng mga direktoryo, mayroon pa ring mga limitasyon dahil sa natural mababang lebel ng ng "Node API".

### Ang mga "Archives" ay "Read-only"

Ang mga "archive" ay hindi maaaring mabago kaya ang lahat ng "Node APIs" na maaaring mabago ang mga payl ay hindi gagana sa "archive" ng `asar`.

### Working Directory Can Not Be Set to Directories in Archive

Though `asar` archives are treated as directories, there are no actual directories in the filesystem, so you can never set the working directory to directories in `asar` archives. Passing them as the `cwd` option of some APIs will also cause errors.

### Extra Unpacking on Some APIs

Most `fs` APIs can read a file or get a file's information from `asar` archives without unpacking, but for some APIs that rely on passing the real file path to underlying system calls, Electron will extract the needed file into a temporary file and pass the path of the temporary file to the APIs to make them work. This adds a little overhead for those APIs.

APIs that requires extra unpacking are:

* `child_process.execFile`
* `child_process.execFileSync`
* `fs.open`
* `fs.openSync`
* `process.dlopen` - Used by `require` on native modules

### Fake Stat Information of `fs.stat`

The `Stats` object returned by `fs.stat` and its friends on files in `asar` archives is generated by guessing, because those files do not exist on the filesystem. So you should not trust the `Stats` object except for getting file size and checking file type.

### Executing Binaries Inside `asar` Archive

There are Node APIs that can execute binaries like `child_process.exec`, `child_process.spawn` and `child_process.execFile`, but only `execFile` is supported to execute binaries inside `asar` archive.

This is because `exec` and `spawn` accept `command` instead of `file` as input, and `command`s are executed under shell. There is no reliable way to determine whether a command uses a file in asar archive, and even if we do, we can not be sure whether we can replace the path in command without side effects.

## Adding Unpacked Files in `asar` Archive

As stated above, some Node APIs will unpack the file to filesystem when calling, apart from the performance issues, it could also lead to false alerts of virus scanners.

To work around this, you can unpack some files creating archives by using the `--unpack` option, an example of excluding shared libraries of native modules is:

```sh
$ asar pack app app.asar --unpack *.node
```

After running the command, apart from the `app.asar`, there is also an `app.asar.unpacked` folder generated which contains the unpacked files, you should copy it together with `app.asar` when shipping it to users.